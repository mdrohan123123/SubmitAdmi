<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROG TEAM - ADMIN PANEL</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  
  <!-- Excel Export Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header */
    .admin-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px 30px;
      margin-bottom: 25px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo h1 {
      font-size: 28px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }

    .logo span {
      font-size: 14px;
      color: #666;
      display: block;
    }

    .admin-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 8px 25px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 16px;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    /* Control Cards */
    .control-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .control-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title i {
      font-size: 24px;
    }

    /* System Status Toggle */
    .status-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 15px;
    }

    .status-info h3 {
      font-size: 16px;
      color: #666;
      margin-bottom: 5px;
    }

    .status-badge {
      padding: 8px 20px;
      border-radius: 30px;
      font-weight: 700;
      font-size: 18px;
    }

    .status-badge.on {
      background: #d4edda;
      color: #155724;
    }

    .status-badge.off {
      background: #f8d7da;
      color: #721c24;
    }

    .toggle-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .toggle-btn.on {
      background: #dc3545;
      color: white;
    }

    .toggle-btn.off {
      background: #28a745;
      color: white;
    }

    /* Input Groups */
    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }

    .input-group input, 
    .input-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .input-group input:focus,
    .input-group textarea:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .input-group textarea {
      height: 100px;
      resize: vertical;
    }

    .update-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .update-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .stat-value {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #666;
      font-size: 14px;
      font-weight: 600;
    }

    /* Data Table Section */
    .data-section {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .data-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }

    .data-title {
      font-size: 20px;
      font-weight: 700;
      color: #333;
    }

    .filter-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 20px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 30px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .filter-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .export-btn {
      padding: 10px 25px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 30px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .export-btn:hover {
      background: #218838;
      transform: translateY(-2px);
    }

    .delete-btn {
      padding: 10px 25px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 30px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .delete-btn:hover {
      background: #c82333;
      transform: translateY(-2px);
    }

    .table-container {
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
      border-radius: 15px;
      border: 1px solid #e0e0e0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: #f8f9fa;
      padding: 15px;
      font-size: 14px;
      font-weight: 700;
      color: #333;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 2px solid #e0e0e0;
    }

    td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e0e0;
      font-size: 14px;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .no-data {
      text-align: center;
      padding: 40px !important;
      color: #999;
      font-size: 16px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 1000;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
    }

    .modal-header {
      font-size: 20px;
      font-weight: 700;
      color: #dc3545;
      margin-bottom: 15px;
    }

    .modal-body {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    .modal-btn.confirm {
      background: #dc3545;
      color: white;
    }

    .modal-btn.cancel {
      background: #6c757d;
      color: white;
    }

    .success-msg {
      background: #d4edda;
      color: #155724;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
    }

    .success-msg.show {
      display: block;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- Header -->
    <div class="admin-header">
      <div class="logo">
        <h1>üî∞ ROG TEAM</h1>
        <span>ADMIN CONTROL PANEL v2.0</span>
      </div>
      <div class="admin-badge">
        ‚ö° FACEBOOK 2FA MANAGER
      </div>
    </div>

    <!-- Success Message -->
    <div class="success-msg" id="successMsg">
      ‚úÖ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
    </div>

    <!-- Control Grid -->
    <div class="control-grid">
      <!-- System Control Card -->
      <div class="control-card">
        <div class="card-title">
          <span>‚öôÔ∏è</span> ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤
        </div>
        
        <div class="status-toggle">
          <div class="status-info">
            <h3>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</h3>
            <div class="status-badge" id="statusBadge">‡¶ö‡¶æ‡¶≤‡ßÅ</div>
          </div>
          <button class="toggle-btn" id="toggleSystemBtn">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <div class="input-group">
          <label>üì¢ ‡¶ü‡¶ø‡¶ï‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</label>
          <textarea id="tickerMessage" placeholder="‡¶ü‡¶ø‡¶ï‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">üîπ ROG TEAM - FACEBOOK 2FA ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ üîπ</textarea>
        </div>

        <div class="input-group">
          <label>‚ö†Ô∏è ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶¨‡¶®‡ßç‡¶ß‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ (‡¶¨‡ßú ‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)</label>
          <input type="text" id="offReason" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∞‡ßá‡¶ó‡ßÅ‡¶≤‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ö‡¶≤‡¶õ‡ßá...">
        </div>

        <button class="update-btn" id="updateSystemBtn">
          <span>üîÑ</span> ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ
        </button>
      </div>

      <!-- Stats Card -->
      <div class="control-card">
        <div class="card-title">
          <span>üìä</span> ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶ø‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡ßç‡¶∏
        </div>
        
        <div class="stats-grid" style="grid-template-columns: 1fr; margin-bottom: 0;">
          <div class="stat-card" style="padding: 15px;">
            <div class="stat-value" id="totalSubmissions">0</div>
            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶®</div>
          </div>
          <div class="stat-card" style="padding: 15px;">
            <div class="stat-value" id="todaySubmissions">0</div>
            <div class="stat-label">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶®</div>
          </div>
          <div class="stat-card" style="padding: 15px;">
            <div class="stat-value" id="uniqueUsers">0</div>
            <div class="stat-label">‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</div>
          </div>
        </div>
      </div>

      <!-- Quick Actions Card -->
      <div class="control-card">
        <div class="card-title">
          <span>‚ö°</span> ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®
        </div>
        
        <button class="update-btn" style="margin-bottom: 10px; background: #28a745;" id="exportAllBtn">
          üì• ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü (‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ)
        </button>
        
        <button class="update-btn" style="margin-bottom: 10px; background: #17a2b8;" id="exportTodayBtn">
          üì• ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü (‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ)
        </button>
        
        <button class="update-btn" style="background: #dc3545;" id="deleteAllBtn">
          üóëÔ∏è ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
        </button>
      </div>
    </div>

    <!-- Data Table Section -->
    <div class="data-section">
      <div class="data-header">
        <div class="data-title">üìã ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</div>
        <div class="filter-group">
          <button class="filter-btn active" data-filter="all">‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ</button>
          <button class="filter-btn" data-filter="today">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ</button>
        </div>
      </div>

      <div class="table-container" id="tableContainer">
        <table id="dataTable">
          <thead>
            <tr>
              <th>#</th>
              <th>UID</th>
              <th>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</th>
              <th>2FA KEY</th>
              <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶ì ‡¶∏‡¶Æ‡¶Ø‡¶º</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="5" class="no-data">‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <div class="modal-header">‚ö†Ô∏è ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
      <div class="modal-body" id="deleteModalMessage">
        ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßÄ‡¶Ø‡¶º‡•§
      </div>
      <div class="modal-buttons">
        <button class="modal-btn confirm" id="confirmDelete">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button class="modal-btn cancel" id="cancelDelete">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyCI4HPJ_mqhqmDjKHQr3Cd302rO2Tud1Go",
        authDomain: "mtwork-fc469.firebaseapp.com",
        databaseURL: "https://mtwork-fc469-default-rtdb.firebaseio.com",
        projectId: "mtwork-fc469",
        storageBucket: "mtwork-fc469.firebasestorage.app",
        messagingSenderId: "351935919939",
        appId: "1:351935919939:web:7ad33f6c3e6e4de26f21f6"
      };

      // Initialize Firebase
      let db;
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        console.log("‚úÖ Admin: Firebase ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§");
      } catch (e) {
        console.error("‚ùå Admin: Firebase ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:", e);
      }

      // DOM Elements
      const statusBadge = document.getElementById('statusBadge');
      const toggleSystemBtn = document.getElementById('toggleSystemBtn');
      const tickerMessage = document.getElementById('tickerMessage');
      const offReason = document.getElementById('offReason');
      const updateSystemBtn = document.getElementById('updateSystemBtn');
      const totalSubmissions = document.getElementById('totalSubmissions');
      const todaySubmissions = document.getElementById('todaySubmissions');
      const uniqueUsers = document.getElementById('uniqueUsers');
      const tableBody = document.getElementById('tableBody');
      const successMsg = document.getElementById('successMsg');
      const exportAllBtn = document.getElementById('exportAllBtn');
      const exportTodayBtn = document.getElementById('exportTodayBtn');
      const deleteAllBtn = document.getElementById('deleteAllBtn');
      const deleteModal = document.getElementById('deleteModal');
      const confirmDelete = document.getElementById('confirmDelete');
      const cancelDelete = document.getElementById('cancelDelete');
      const filterBtns = document.querySelectorAll('.filter-btn');

      // State
      let currentFilter = 'all';
      let allData = [];
      let systemStatus = true;

      // Load System Status
      function loadSystemStatus() {
        if (!db) return;
        
        db.ref("system_control").on("value", (snapshot) => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            systemStatus = data.status !== undefined ? data.status : true;
            tickerMessage.value = data.ticker_message || 'üîπ ROG TEAM - FACEBOOK 2FA ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ üîπ';
            offReason.value = data.off_reason || '';
            
            updateStatusUI();
          }
        });
      }

      function updateStatusUI() {
        if (systemStatus) {
          statusBadge.textContent = '‚úÖ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá';
          statusBadge.className = 'status-badge on';
          toggleSystemBtn.textContent = '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®';
          toggleSystemBtn.className = 'toggle-btn on';
        } else {
          statusBadge.textContent = 'üî¥ ‡¶¨‡¶®‡ßç‡¶ß ‡¶Ü‡¶õ‡ßá';
          statusBadge.className = 'status-badge off';
          toggleSystemBtn.textContent = '‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®';
          toggleSystemBtn.className = 'toggle-btn off';
        }
      }

      // Toggle System
      toggleSystemBtn.addEventListener('click', async () => {
        if (!db) return;
        
        const newStatus = !systemStatus;
        try {
          await db.ref("system_control").update({
            status: newStatus,
            ticker_message: tickerMessage.value,
            off_reason: offReason.value
          });
          showSuccess();
        } catch (error) {
          alert('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message);
        }
      });

      // Update System
      updateSystemBtn.addEventListener('click', async () => {
        if (!db) return;
        
        try {
          await db.ref("system_control").update({
            status: systemStatus,
            ticker_message: tickerMessage.value,
            off_reason: offReason.value
          });
          showSuccess();
        } catch (error) {
          alert('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message);
        }
      });

      // Load Data
      function loadData() {
        if (!db) return;
        
        db.ref("instagram_2fa_submissions").on("value", (snapshot) => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            allData = Object.entries(data).map(([id, item]) => ({
              id,
              ...item,
              submitted_at: item.submitted_at || new Date().toISOString()
            })).sort((a, b) => new Date(b.submitted_at) - new Date(a.submitted_at));
            
            updateStats();
            renderTable();
          } else {
            allData = [];
            tableBody.innerHTML = '<tr><td colspan="5" class="no-data">üì≠ ‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>';
            totalSubmissions.textContent = '0';
            todaySubmissions.textContent = '0';
            uniqueUsers.textContent = '0';
          }
        });
      }

      function updateStats() {
        totalSubmissions.textContent = allData.length;
        
        const today = new Date().toDateString();
        const todayData = allData.filter(item => {
          const itemDate = new Date(item.submitted_at).toDateString();
          return itemDate === today;
        });
        todaySubmissions.textContent = todayData.length;
        
        const uniqueUidCount = new Set(allData.map(item => item.username)).size;
        uniqueUsers.textContent = uniqueUidCount;
      }

      function renderTable() {
        let filteredData = allData;
        
        if (currentFilter === 'today') {
          const today = new Date().toDateString();
          filteredData = allData.filter(item => {
            const itemDate = new Date(item.submitted_at).toDateString();
            return itemDate === today;
          });
        }
        
        if (filteredData.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="5" class="no-data">üì≠ ‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>';
          return;
        }
        
        let html = '';
        filteredData.forEach((item, index) => {
          const date = new Date(item.submitted_at);
          const formattedDate = `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()} ${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;
          
          html += `
            <tr>
              <td>${index + 1}</td>
              <td><strong>${item.username || 'N/A'}</strong></td>
              <td>${item.password || 'N/A'}</td>
              <td>${item.fa_key || item.cookie_2fa || 'N/A'}</td>
              <td>${formattedDate}</td>
            </tr>
          `;
        });
        
        tableBody.innerHTML = html;
      }

      // Export to Excel
      function exportToExcel(filterType) {
        let dataToExport = allData;
        
        if (filterType === 'today') {
          const today = new Date().toDateString();
          dataToExport = allData.filter(item => {
            const itemDate = new Date(item.submitted_at).toDateString();
            return itemDate === today;
          });
        }
        
        if (dataToExport.length === 0) {
          alert('‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á!');
          return;
        }
        
        // Prepare data for Excel (A: UID, B: Password, C: 2FA KEY)
        const excelData = dataToExport.map(item => [
          item.username || '',
          item.password || '',
          item.fa_key || item.cookie_2fa || ''
        ]);
        
        // Add header
        excelData.unshift(['UID', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°', '2FA KEY']);
        
        // Create workbook
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(excelData);
        
        // Set column widths
        ws['!cols'] = [{ wch: 20 }, { wch: 30 }, { wch: 40 }];
        
        XLSX.utils.book_append_sheet(wb, ws, 'Facebook 2FA Data');
        
        // Download
        const fileName = `facebook_2fa_${filterType}_${new Date().toISOString().split('T')[0]}.xlsx`;
        XLSX.writeFile(wb, fileName);
      }

      // Delete All Data
      async function deleteAllData() {
        if (!db) return;
        
        try {
          await db.ref("instagram_2fa_submissions").remove();
          await db.ref("instagram_used_usernames").remove();
          deleteModal.classList.remove('active');
          showSuccess('‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
        } catch (error) {
          alert('‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message);
        }
      }

      // Show Success Message
      function showSuccess(message = '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá') {
        successMsg.textContent = '‚úÖ ' + message;
        successMsg.classList.add('show');
        setTimeout(() => {
          successMsg.classList.remove('show');
        }, 3000);
      }

      // Event Listeners
      exportAllBtn.addEventListener('click', () => exportToExcel('all'));
      exportTodayBtn.addEventListener('click', () => exportToExcel('today'));

      deleteAllBtn.addEventListener('click', () => {
        if (allData.length === 0) {
          alert('‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á!');
          return;
        }
        deleteModal.classList.add('active');
      });

      confirmDelete.addEventListener('click', deleteAllData);
      
      cancelDelete.addEventListener('click', () => {
        deleteModal.classList.remove('active');
      });

      filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          filterBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilter = btn.dataset.filter;
          renderTable();
        });
      });

      // Close modal on outside click
      deleteModal.addEventListener('click', (e) => {
        if (e.target === deleteModal) {
          deleteModal.classList.remove('active');
        }
      });

      // Initialize
      loadSystemStatus();
      loadData();

      // Auto refresh every 30 seconds
      setInterval(() => {
        if (db) {
          db.ref("instagram_2fa_submissions").once("value", (snapshot) => {
            if (snapshot.exists()) {
              const data = snapshot.val();
              allData = Object.entries(data).map(([id, item]) => ({
                id,
                ...item,
                submitted_at: item.submitted_at || new Date().toISOString()
              })).sort((a, b) => new Date(b.submitted_at) - new Date(a.submitted_at));
              
              updateStats();
              renderTable();
            }
          });
        }
      }, 30000);
    })();
  </script>
</body>
</html>
